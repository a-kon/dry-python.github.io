<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="Dry-Python"><meta name="author" content="Artem Malyshev"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Readability matters</title><link href="slides.css" rel="stylesheet"></head><body><div class="reveal"><div class="slides"><section><h1>Readability matters</h1><h2><a href="https://dry-python.org/">dry-python.org</a></h2><h4>Artem Malyshev</h4></section><section><h2>BIO</h2><ul><li>5 years experience in Python</li><li>Django Channels 1.0</li><li>Dry Python</li></ul></section><section><h2>Code is...</h2><p class="fragment"><b>hard</b></p><p class="fragment"><b>and frustrating</b></p><ol><li class="fragment">Framework independent</li><li class="fragment">Let's consider WEB for simplicity</li></ol></section><section data-background-image="aff5c485c382439a300952a1903aa1b7.jpg" data-background-size="contain"><br></section><section><h2>Micro framework</h2><ol><li class="fragment">Long handlers</li><li class="fragment">Lots of "if" statements</li></ol></section><section><h2>Long handlers</h2><pre><code class="python">121    if props[-1].endswith('$'):
122 -&gt;     props[-1] = props[-1][:-1]
123</code></pre><pre class="fragment"><code class="python">Traceback (most recent call last):
  File "views.py", line 1027, in post
ZeroDivisionError: division by zero</code></pre></section><section data-background-image="b4353ae91abb68108aaf28f8c3a76c5c.jpg" data-background-size="contain"><br></section><section><h2>Big framework</h2><ol><li class="fragment">You need method flowchart</li><li class="fragment">Zig-zag in the traceback</li><li class="fragment">Framework internals leak</li></ol></section><section data-background-image="ec7fb2b01603f0b5a5c9357bbd161119.png" data-background-size="contain"><br></section><section><h2>Framework internals leak</h2><pre><code class="python">def recreate_nested_writable_fields(self, instance):
    for field, values in self.writable_fields_to_recreate():
        related_manager = getattr(instance, field)
        related_manager.all().delete()
        for data in values:
            obj = related_manager.model.objects.create(
                to=instance, **data)
            related_manager.add(obj)</code></pre></section><section><h2>As a result code is...</h2><ol><li class="fragment">Fragile</li><li class="fragment">Hard to reason about</li><li class="fragment">Time-consuming</li></ol></section><section data-background-image="06a860001b178abdb64cf9eed1cc3786.jpg" data-background-size="auto" data-background-position="top"><br></section><section><blockquote><p>If your code is crap, stickies on the wall won't help.</p><a href="https://twitter.com/henrikkniberg">@HenrikKniberg</a><img class="plain" src="8b5cce5f4a93c75cc2e5028723fba061.jpg"></blockquote></section><section><h2>Dry Python</h2><p>It is a set of libraries aimed to improve architecture and code design</p><img class="plain" src="https://raw.githubusercontent.com/dry-python/brand/master/logo/dry-python.png"></section><section><h2>Business objects</h2><pre><code class="python">def buy_subscription(category_id, price_id, user):

    category = find_category(category_id)
    price = find_price(price_id)
    profile = find_profile(user)
    if profile.balance &lt; price.cost:
        raise ValueError
    del_balance(profile, price.cost)
    save_profile(profile)
    expires = calculate_period(price.period)
    subscription = create_subscription(
        profile, category, expires)
    notification = send_notification(
        "subscription", profile, category.name)</code></pre></section><section><img class="plain" src="https://raw.githubusercontent.com/dry-python/brand/master/logo/stories.png"><pre><code>from stories import story, argument

class Subscription:
    @story
    @argument("category_id")
    @argument("price_id")
    def buy(self):
        self.find_category()
        self.find_price()
        self.find_profile()
        self.check_balance()
        self.persist_payment()
        self.persist_subscription()
        self.send_subscription_notification()</code></pre></section><section><h2>Context</h2><pre><code class="python">(Pdb) self
Subscription.buy:
  find_category
  check_price
  check_purchase (PromoCode.validate)
    find_code (skipped)
  check_balance
    find_profile</code></pre><pre><code class="python">(Pdb) self.ctx
Context:
    category_id = 1318  # Story argument
    user = &lt;User: 3292&gt; # Story argument
    category = &lt;Category: 1318&gt;
      # Set by Subscription.find_category
    code = None         # Set by PromoCode.find_code</code></pre></section><section data-background-image="335b1cb95d5010bb26e11d96f39114bc.png" data-background-size="contain"><br></section><section data-background-image="0b268941b08e07b82b1982ba847f31ec.png" data-background-size="contain"><br></section><section data-background-image="4427b3c017312108535dcfd25fd5898c.png" data-background-size="contain"><br></section><section><img class="plain" src="https://raw.githubusercontent.com/dry-python/brand/master/logo/dependencies.png"><p>Boilerplate-free <b>stories</b> integration with different frameworks.</p></section><section><h2>Django views</h2><pre><code class="python">@view
class BuySubscriptionView(Injector):
    buy_subscription = services.Subscription.buy
    category_id = this.form.cleared_data['category_id']

    @operation
    def post(buy_subscription, category_id, user):
        result = buy_subscription.run(category_id, price_id)
        if result.is_success:
            return redirect(result.value)</code></pre></section><section><h2>Celery Task</h2><pre><code class="python">@task
class PutMoneyTask(Injector):
    put_money = services.PutMoneyIntoAccount.put
    amount = this.kwargs['amount']

    @operation
    def run(put_money, user, amount, task):
        result = put_money.run(user, amount)
        if result.is_failure:
            task.on_failure(result.ctx.transaction_id)</code></pre></section><section><h2>Plans</h2><ol><li>asyncio support</li><li>flask support</li><li>typing advantages</li><li>linters integration</li></ol></section><section><h2>Try it!</h2><pre><code>$ pip install stories</code></pre><pre><code>$ pip install dependencies</code></pre></section><section><h2>Get in touch</h2><ul><li><a href="https://dry-python.org/">Website</a></li><li><a href="https://twitter.com/dry_py">Twitter</a></li><li><a href="https://github.com/dry-python">Github</a></li></ul></section></div></div><script type="text/javascript" src="slides.js"></script></body></html>